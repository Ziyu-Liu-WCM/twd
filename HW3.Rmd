---
title: "Consult p3"
author: "Ziyu Liu"
date: "2024-03-28"
output: html_document
---

## Method

Methods
Study Population and Data Collection
This retrospective cohort study analyzed a dataset comprising N pregnant individuals. The dataset included information on birthweight and potential predictors of low birthweight, including maternal age, mother's weight at last menstrual period, smoking status during pregnancy, and hypertension status. Low birthweight was defined as a birthweight of less than 2500 grams.

Data Preparation
The dataset, referred to as tab1, was first subjected to a cleaning process to ensure accuracy and completeness. Variables included in the analysis were verified for their appropriate scale of measurement and transformed as needed. Categorical variables, such as smoking status and hypertension status, were encoded as factors. A binary outcome variable was created to represent low birthweight (birthweight < 2500 grams).

Statistical Analysis
Univariate Analysis
Initial analyses examined the distribution of each predictor variable, followed by univariate logistic regression models to assess the crude association between each predictor and the outcome of low birthweight. Frequencies and percentages of the outcome variable within levels of the categorical predictor variables were tabulated to explore the data's distribution.

Multivariable Logistic Regression Analysis
The main analysis involved constructing a multivariable logistic regression model to estimate the independent effect of the predictors on the likelihood of low birthweight. Prior to model fitting, multicollinearity among predictors was assessed using variance inflation factors (VIFs), with a threshold of VIF > 10 indicating significant collinearity. Given a detected collinearity between maternal age and mother's weight at last menstrual period, a decision was made based on theoretical considerations and VIF scores to include both variables in the model, as their VIF scores did not suggest problematic multicollinearity (VIF < 2).

The final logistic regression model included maternal age, mother's weight at last menstrual period, smoking status, and hypertension status as independent variables. The model was specified as follows:
\begin{equation}
\log\left(\frac{P(\text{Low Birthweight})}{1 - P(\text{Low Birthweight})}\right) = \beta_0 + \beta_1(\text{Maternal Age}) + \beta_2(\text{Mother's Weight}) + \beta_3(\text{Smoking Status}) + \beta_4(\text{Hypertension Status})
\end{equation}

where \(P(\text{Low Birthweight})\) denotes the probability of low birthweight.

Model Evaluation
The goodness-of-fit of the model was evaluated using the Hosmer-Lemeshow test. The statistical significance of individual predictors was assessed using Wald tests, with p-values less than 0.05 considered indicative of statistically significant associations.

Software
All analyses were performed using R statistical software (version x.y.z). The glm function was employed for logistic regression modeling, and the car package was used for multicollinearity assessment.

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r, echo=FALSE}
library(tidyverse)
library(readxl)
library(janitor)
library(gtsummary)
library(corrplot)
library(caret)
library(MASS)
library(kableExtra)
library(dotwhisker)
library(AppliedPredictiveModeling)
library(pROC)
library(car)
```

```{r, echo=FALSE}
lbw = read_excel("lbw.xls") %>% janitor::clean_names()
head(lbw)
```

## Exploratory Analysis
```{r, echo=FALSE}
tab1 <- lbw %>%
  dplyr::select(-subject_id) %>%
  mutate(birthweight_in_grams = as.factor(ifelse(birthweight_in_grams < 2500, "<2500", ">=2500"))) %>%
  rename(Age = maternal_age_in_years,
         Motherweight = mothers_weight_at_last_menstrual_period_in_pounds,
         Smoking = smoking_status,
         Hypertension = hypertension_status,
         Birthweight = birthweight_in_grams) %>%
  drop_na()

tab1$Smoking <- as.factor(tab1$Smoking)
tab1$Hypertension <- as.factor(tab1$Hypertension)


tbl_summary(tab1)
```

```{r, echo=FALSE}
summary(summary(lm(Age ~ Motherweight, data = tab1)))
```

## univariate (unadjusted) analyses

### Smoking
```{r, echo=FALSE}
smoking_crosstab <- table(tab1$Smoking, tab1$Birthweight)
smoking_percent <- prop.table(smoking_crosstab, 1) * 100

smoking_combined <- paste(smoking_crosstab, "(", sprintf("%.1f%%", smoking_percent), ")", sep="")
smoking_combined <- matrix(smoking_combined, nrow = nrow(smoking_crosstab), byrow = TRUE, dimnames = dimnames(smoking_crosstab))
knitr::kable(smoking_combined, caption = "Smoking Status and Low Birthweight")
cat("The p-value from chi-square test is", round(chisq.test(smoking_crosstab)$p.value, 4))
```

### Hypertension Status
```{r, echo=FALSE}
hypertension_crosstab <- table(tab1$Hypertension, tab1$Birthweight)
hypertension_percent <- prop.table(hypertension_crosstab, 1) * 100

hypertension_combined <- paste(hypertension_crosstab, "(", sprintf("%.1f%%", hypertension_percent), ")", sep="")
hypertension_combined <- matrix(hypertension_combined, nrow = nrow(hypertension_crosstab), byrow = TRUE, dimnames = dimnames(hypertension_crosstab))
print(hypertension_combined)
cat("The p-value from Fisher's Exact test is",  round(fisher.test(hypertension_crosstab)$p.value, 4))
```


### Age
```{r, echo=FALSE}
age_low <- tab1$Age[tab1$Birthweight == "<2500"]
age_not_low <- tab1$Age[tab1$Birthweight == ">=2500"]
wilcox_test_age <- wilcox.test(age_low, age_not_low)
print(wilcox_test_age)
```

### Weight
```{r, echo=FALSE}
weight_low <- tab1$Motherweight[tab1$Birthweight == "<2500"]
weight_not_low <- tab1$Motherweight[tab1$Birthweight == ">=2500"]
wilcox_test_weight <- wilcox.test(weight_low, weight_not_low)
print(wilcox_test_weight)
```

## Multivariable Analysis
```{r, echo=FALSE}
model <- glm(Birthweight ~ Age + Motherweight + Smoking + Hypertension, 
             data = tab1, 
             family = binomial)
summary(model)
```



```{r, echo=FALSE}
vif(model)
```

### Interaction between motherâ€™s weight
```{r}
model_add <- glm(Birthweight ~ Age + Motherweight + Smoking + Hypertension + Motherweight*Hypertension, 
             data = tab1, 
             family = binomial)
summary(model_add)

anova(model, model_add)
```

From the AIC perspective, adding the interaction term doesn't improve the model

```{r, echo=FALSE}
step.model <- stepAIC(model, direction = "both", trace = FALSE)
summary(step.model)
```

```{r, echo=FALSE}
broom::tidy(
  stepAIC(step.model, direction = "both", trace = FALSE),
  exp = TRUE, conf.int = TRUE) %>%   
         relabel_predictors(`Concave points` = "Concave points") %>% 
    rename(`Adjusted Odds Ratio` = estimate,
         `Standard Error` = std.error,
         `P-value` = p.value,
         `Lower 95% CI` = conf.low,
         `Upper 95% CI` = conf.high,
         `Term` = term) %>% 
  dplyr::select(Term, `Adjusted Odds Ratio`, `Lower 95% CI`, `Upper 95% CI`, `P-value`) %>% 
  mutate_if(is.numeric, round, 3) %>% 
  mutate(`P-value` = ifelse(`P-value` == 0.00, "< 0.01", `P-value`),
         `P-value` = ifelse(`P-value` < 0.01, "< 0.01", `P-value`),
         `P-value` = ifelse(`P-value` == 1e-04, "< 0.01", `P-value`),
         `P-value` = ifelse(`P-value` == 5e-04, "< 0.01", `P-value`)) %>% 
  filter(Term != "(Intercept)") %>%
  kable() %>% kable_styling("striped")
```

